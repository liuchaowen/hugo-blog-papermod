<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=referrer content="no-referrer"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Heatmap4Hugo每日文章数热力图 | Blog - XLapTop</title><meta name=keywords content="heatmap,hugo,热力图"><meta name=description content="初衷与思路 想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目： 思路：使用rss的数据，即 [domain]/ind"><meta name=author content="Chao"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.4fab041bcf7de8e300dd24af5650aa1c095a254467515066c181153f9627980b.css integrity="sha256-T6sEG8996OMA3SSvVlCqHAlaJURnUVBmwYEVP5YnmAs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.xlap.top/icon/favicon_32.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.xlap.top/icon/favicon_16.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.xlap.top/icon/favicon_32.ico><link rel=apple-touch-icon href=https://blog.xlap.top/icon/apple-touch-icon.png><link rel=mask-icon href=https://blog.xlap.top/icon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script id=LA_COLLECT src="https://sdk.51.la/js-sdk-pro.min.js?id=JvUDwnR8WxIRefWQ&ck=JvUDwnR8WxIRefWQ"></script>
<script src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link rel=stylesheet href=https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css media=print onload='this.media="all"'><script src=https://cdn.staticfile.org/twikoo/1.6.10/twikoo.all.min.js></script>
<link rel=stylesheet href=/css/styles.css \><script src=/js/application.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Heatmap4Hugo每日文章数热力图"><meta property="og:description" content="初衷与思路 想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目： 思路：使用rss的数据，即 [domain]/ind"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.xlap.top/post/tech/heatmap4hugo/"><meta property="og:image" content="https://blog.xlap.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-02-27T23:30:26+08:00"><meta property="article:modified_time" content="2023-02-27T23:30:26+08:00"><meta property="og:site_name" content="Blog - XLapTop"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.xlap.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Heatmap4Hugo每日文章数热力图"><meta name=twitter:description content="初衷与思路 想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目： 思路：使用rss的数据，即 [domain]/ind"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.xlap.top/post/"},{"@type":"ListItem","position":2,"name":"Heatmap4Hugo每日文章数热力图","item":"https://blog.xlap.top/post/tech/heatmap4hugo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Heatmap4Hugo每日文章数热力图","name":"Heatmap4Hugo每日文章数热力图","description":"初衷与思路 想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目： 思路：使用rss的数据，即 [domain]/ind","keywords":["heatmap","hugo","热力图"],"articleBody":"初衷与思路 想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目：\n思路：使用rss的数据，即 [domain]/index.xml为数据源，使用纯JS前端做逻辑。\n最终效果：\n于是，开搞！\n引入文件 在themes/xxx/layouts/partials/extend_head.html 尾部插入代码：\nhtml\r{{- if .IsHome }} {{- /* cal-heatmap */}} \u003cscript src=\"https://d3js.org/d3.v7.min.js\"\u003e\u003c/script\u003e \u003cscript src=\"https://unpkg.com/cal-heatmap@4.0.0-beta.9/dist/cal-heatmap.min.js\"\u003e\u003c/script\u003e \u003clink rel=\"stylesheet\" href=\"https://unpkg.com/cal-heatmap@4.0.0-beta.9/dist/cal-heatmap.css\"\u003e\u003c/script\u003e {{/* tooltip */}} \u003cscript src=\"https://unpkg.com/@popperjs/core@2\"\u003e\u003c/script\u003e \u003cscript src=\"https://unpkg.com/tippy.js@6\"\u003e\u003c/script\u003e {{- end }}\r放在首页就做个IF判断，上部分是cal-heatmap依赖，下部分是鼠标移到小格子显示的tooltip依赖。\n编写主文件 在static/js 新增主逻辑文件cal-heatmap.js，更新看本人的github项目 javascript\r/*结果变量*/ const weekNum = 8; const resultObj = {}; const resultList = []; /*获取index.xml页面的数据*/ //补位0 function Appendzero(obj) { if (obj \u003c 10) return \"0\" + \"\" + obj; else return obj; } if (window.XMLHttpRequest) { xhttp = new XMLHttpRequest(); } else { // IE 5/6 xhttp = new ActiveXObject(\"Microsoft.XMLHTTP\"); } var localurl = \"/index.xml\"; //ssr地址 xhttp.overrideMimeType(\"text/xml\"); xhttp.open(\"GET\", localurl, false); xhttp.send(null); xmlDoc = xhttp.responseXML; //遍历元素 var rootEle = xmlDoc.getElementsByTagName(\"channel\")[0][\"children\"]; for (var key in rootEle) { var element = rootEle[key]; if (element.nodeName == \"item\") { var child = element[\"children\"]; var title = child[0]; var pubDate = child[2]; if (pubDate.textContent == \"\" || title.textContent == \"\") { continue; } var date = new Date(pubDate.textContent); var dateFormat = date.getFullYear() + \"-\" + Appendzero(date.getMonth() + 1) + \"-\" + Appendzero(date.getDate()); if (resultObj.hasOwnProperty(dateFormat)) { resultObj[dateFormat][\"num\"]++; resultObj[dateFormat][\"postTitles\"] += \",\" + title.textContent; } else { resultObj[dateFormat] = {}; resultObj[dateFormat][\"num\"] = 1; resultObj[dateFormat][\"postTitles\"] = title.textContent; } } } //遍历obj，放入list for (var key in resultObj) { var val = resultObj[key]; var tmpJson = { date: key, value: val[\"num\"], title: val[\"postTitles\"] }; resultList.push(tmpJson); } // console.log(\"HeatMap处理后的结果\", resultList); /*获取数据*/ //获取上几个星期的天 function getLastNWeeksDate(n) { const now = new Date(); return new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7 * n); } //获取这星期的周一 function getMonday(d) { d = new Date(d); var day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6 : 1); // adjust when day is sunday return new Date(d.setDate(diff)); } var lastnweekday = getLastNWeeksDate(weekNum - 2); var firstday = getMonday(lastnweekday); const cal = new CalHeatmap(); //一年 // cal.paint({ // theme: \"dark\", // domain: { type: \"month\" }, // subDomain: { type: \"day\", label: \"D\", sort: \"asc\" }, // }); //一月 // cal.paint({ // theme: \"dark\", // domain: { // type: \"month\", // label: { // text: null, //不显示标签 // }, // }, // range: 1, // subDomain: { type: \"day\", label: \"D\", sort: \"asc\" }, // }); /*深色与明亮主题初始值判断*/ var isDark = document.body.className.includes(\"dark\"); // console.log(\"是否深色主题\", isDark); var hlDate = new Date().toLocaleDateString(); var hlArr = hlDate.split('/'); var dateFormat = hlArr[0] + \"-\" + Appendzero(hlArr[1]) + \"-\" + Appendzero(hlArr[2]); var realHLDate = new Date(dateFormat); /* 参数 */ var options = { animationDuration: 200, theme: isDark ? \"dark\" : \"light\", verticalOrientation: true, date: { start: firstday, //开始时间为上8-2个周的周一 highlight: [realHLDate], locale: { weekStart: 1 }, //周一为第一天 }, domain: { type: \"week\", label: { position: \"right\", text: null, //不显示标签 }, }, range: weekNum, subDomain: { width: 12, height: 12, type: \"day\", // label: \"D\", //D是显示日期的日；null是不显示；回调函数是自定义 label: function (timestamp, value) { return value; }, sort: \"asc\", }, data: { type: \"json\", source: resultList, x: \"date\", y: \"value\", }, scale: { color: { range: [\"#eea2a4\", \"#5c2223\"], //[浅色，深色] interpolate: \"hsl\", type: \"linear\", domain: [0, 5], //文章数阈值：[min,max] }, }, }; /*深色与明亮主题切换监听*/ document.getElementById(\"theme-toggle\").addEventListener(\"click\", () =\u003e { location.reload();// 由于没有重新渲染的函数，只能刷新界面 }); /*渲染*/ cal.paint(options); /*初始点击的数据*/ let listObj = {} function initClickUrls() { fetch(\"/index.xml\") .then((res) =\u003e res.text()) .then((str) =\u003e new window.DOMParser().parseFromString(str, \"text/xml\")) .then((data) =\u003e { let ls = data.querySelectorAll(\"channel item\"); listObj = {}; ls.forEach(element =\u003e { let eleCollect = element.children; let dateStr = eleCollect.item(2).textContent; let url = eleCollect.item(3).textContent; let dateTs = Date.parse(dateStr); var date = new Date(dateTs); var ymd = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate(); if (listObj.hasOwnProperty(ymd)) { listObj[ymd]['url'].push(url); } else { listObj[ymd] = { 'date': ymd, 'url': [url] }; } }); console.log(listObj) }); } initClickUrls(); //事件处理 cal.on(\"mouseover\", (event, timestamp, value) =\u003e { var date = new Date(timestamp); var dateFormat = Appendzero(date.getMonth() + 1) + \"/\" + Appendzero(date.getDate()); var str = '周' + '日一二三四五六'.charAt(new Date(timestamp).getDay()); var tips = \"\"; if (value == null) { tips = str + \" \" + dateFormat + \" , 懒虫!\"; } else { tips = str + \" \" + dateFormat + \" , \" + value + \" 篇\"; } tippy(event.target, { placement: \"top\", content: tips, }); }); cal.on('click', (event, timestamp, value) =\u003e { var date = new Date(timestamp); var ymd = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate(); var dateObj = listObj[ymd]; if (dateObj) { var urlList = dateObj.url; if (urlList \u0026\u0026 urlList.length \u003e 0) { var locationHref = urlList[Math.floor(Math.random() * urlList.length)]; location.href = locationHref; } } });\r多种样式，如显示1年，1个月，2个月等自行修改代码，因为我的主题适合规规矩矩的，所以使用8周为时间单位。\n(可忽略) 在static/css 新增主逻辑文件footer-home.css，更新看本人的github项目\n.first-entry { position: relative; display: flex; flex-direction: row; justify-content: space-between; align-items: center; min-height: 320px; } .cal-heatmap-container { display: flex; flex-direction: row; justify-content: flex-end; align-items: center; width: max-content; } 引入主文件 在themes/xxx/layouts/partials/extend_footer.html 尾部插入代码：\n{{- if .IsHome }} {{- /* cal-heatmap */ -}} \u003cscript type=\"text/javascript\" src=\"js/cal-heatmap.js\"\u003e\u003c/script\u003e \u003clink rel=\"stylesheet\" href=\"css/footer-home.css\"\u003e {{- end }} 大功告成~ 如有疑问可留言！\n后续问题 dark/light主题切换问题 tooltip显示 点击日期进入相关post页面 ","wordCount":"1581","inLanguage":"zh","datePublished":"2023-02-27T23:30:26+08:00","dateModified":"2023-02-27T23:30:26+08:00","author":{"@type":"Person","name":"Chao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.xlap.top/post/tech/heatmap4hugo/"},"publisher":{"@type":"Organization","name":"Blog - XLapTop","logo":{"@type":"ImageObject","url":"https://blog.xlap.top/icon/favicon_32.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.xlap.top/ accesskey=h title="LapTop (Alt + H)"><img src=https://blog.xlap.top/logo.png alt aria-label=logo height=35>LapTop</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.xlap.top/about/ title=关于><span>关于</span></a></li><li><a href=https://blog.xlap.top/links/ title=友邻><span>友邻</span></a></li><li><a href=https://blog.xlap.top/archives/ title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.xlap.top/>主页</a>&nbsp;»&nbsp;<a href=https://blog.xlap.top/post/>Posts</a></div><h1 class=post-title>Heatmap4Hugo每日文章数热力图</h1><div class=post-meta><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span> 阅读</span>
&nbsp;·&nbsp;技术&nbsp;·&nbsp;<span title='2023-02-27 23:30:26 +0800 CST'>周一, 二月 27, 2023</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;1581 字&nbsp;|&nbsp;<a href=https://github.com/liuchaowen/hugo-blog-papermod/tree/main/content/post/tech/Heatmap4Hugo.md rel="noopener noreferrer" target=_blank>Repo</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#初衷与思路>初衷与思路</a></li><li><a href=#引入文件>引入文件</a></li><li><a href=#编写主文件>编写主文件</a></li><li><a href=#引入主文件>引入主文件</a></li><li><a href=#后续问题>后续问题</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=初衷与思路>初衷与思路<a hidden class=anchor aria-hidden=true href=#初衷与思路>#</a></h3><p>想做在Hugo做一个类似Github那样的每日提交热度图，找到了一个很火的项目：</p><article class=shortcode-card><a href=https://github.com/wa0x6e/cal-heatmap target=_blank rel=noopener><header><img alt=wa0x6e/cal-heatmap src=https://opengraph.githubassets.com/1/wa0x6e/cal-heatmap></header><div class=shortcode-card-content></div></a></article><p>思路：使用rss的数据，即 [domain]/index.xml为数据源，使用纯JS前端做逻辑。</p><p>最终效果：</p><p><img loading=lazy src=https://i.imgtg.com/2023/02/27/VkNCM.png alt=endeffect></p><p>于是，开搞！</p><h3 id=引入文件>引入文件<a hidden class=anchor aria-hidden=true href=#引入文件>#</a></h3><p>在themes/xxx/layouts/partials/extend_head.html 尾部插入代码：</p><div class=highlight-wrapper><div class=highlight-before style=display:none>html</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{- if .IsHome }}
</span></span><span class=line><span class=cl>{{- /* cal-heatmap */}}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://d3js.org/d3.v7.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/cal-heatmap@4.0.0-beta.9/dist/cal-heatmap.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/cal-heatmap@4.0.0-beta.9/dist/cal-heatmap.css&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{/* tooltip */}}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/@popperjs/core@2&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/tippy.js@6&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{- end }}</span></span></code></pre></div></div><p>放在首页就做个IF判断，上部分是cal-heatmap依赖，下部分是鼠标移到小格子显示的tooltip依赖。</p><h3 id=编写主文件>编写主文件<a hidden class=anchor aria-hidden=true href=#编写主文件>#</a></h3><p>在static/js 新增主逻辑文件cal-heatmap.js，更新看本人的github项目<div class=highlight-wrapper><div class=highlight-before style=display:none>javascript</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/*结果变量*/</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>weekNum</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>resultObj</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>resultList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*获取index.xml页面的数据*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//补位0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>obj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>obj</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;0&#34;</span> <span class=o>+</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=k>return</span> <span class=nx>obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>XMLHttpRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhttp</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// IE 5/6
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>xhttp</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ActiveXObject</span><span class=p>(</span><span class=s2>&#34;Microsoft.XMLHTTP&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>localurl</span> <span class=o>=</span> <span class=s2>&#34;/index.xml&#34;</span><span class=p>;</span> <span class=c1>//ssr地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>xhttp</span><span class=p>.</span><span class=nx>overrideMimeType</span><span class=p>(</span><span class=s2>&#34;text/xml&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>xhttp</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=nx>localurl</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>xhttp</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>xmlDoc</span> <span class=o>=</span> <span class=nx>xhttp</span><span class=p>.</span><span class=nx>responseXML</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//遍历元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>rootEle</span> <span class=o>=</span> <span class=nx>xmlDoc</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;channel&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&#34;children&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>rootEle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>element</span> <span class=o>=</span> <span class=nx>rootEle</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>nodeName</span> <span class=o>==</span> <span class=s2>&#34;item&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>child</span> <span class=o>=</span> <span class=nx>element</span><span class=p>[</span><span class=s2>&#34;children&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>child</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>pubDate</span> <span class=o>=</span> <span class=nx>child</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>pubDate</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span> <span class=o>||</span> <span class=nx>title</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>pubDate</span><span class=p>.</span><span class=nx>textContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>dateFormat</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=nx>date</span><span class=p>.</span><span class=nx>getFullYear</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;-&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;-&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getDate</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>resultObj</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>dateFormat</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>resultObj</span><span class=p>[</span><span class=nx>dateFormat</span><span class=p>][</span><span class=s2>&#34;num&#34;</span><span class=p>]</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>resultObj</span><span class=p>[</span><span class=nx>dateFormat</span><span class=p>][</span><span class=s2>&#34;postTitles&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=s2>&#34;,&#34;</span> <span class=o>+</span> <span class=nx>title</span><span class=p>.</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>resultObj</span><span class=p>[</span><span class=nx>dateFormat</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=nx>resultObj</span><span class=p>[</span><span class=nx>dateFormat</span><span class=p>][</span><span class=s2>&#34;num&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>resultObj</span><span class=p>[</span><span class=nx>dateFormat</span><span class=p>][</span><span class=s2>&#34;postTitles&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=nx>title</span><span class=p>.</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//遍历obj，放入list
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>resultObj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>resultObj</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>tmpJson</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>date</span><span class=o>:</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>val</span><span class=p>[</span><span class=s2>&#34;num&#34;</span><span class=p>],</span> <span class=nx>title</span><span class=o>:</span> <span class=nx>val</span><span class=p>[</span><span class=s2>&#34;postTitles&#34;</span><span class=p>]</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>resultList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>tmpJson</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// console.log(&#34;HeatMap处理后的结果&#34;, resultList);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/*获取数据*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//获取上几个星期的天
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getLastNWeeksDate</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nx>getFullYear</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nx>getDate</span><span class=p>()</span> <span class=o>-</span> <span class=mi>7</span> <span class=o>*</span> <span class=nx>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//获取这星期的周一
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getMonday</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>d</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>day</span> <span class=o>=</span> <span class=nx>d</span><span class=p>.</span><span class=nx>getDay</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>diff</span> <span class=o>=</span> <span class=nx>d</span><span class=p>.</span><span class=nx>getDate</span><span class=p>()</span> <span class=o>-</span> <span class=nx>day</span> <span class=o>+</span> <span class=p>(</span><span class=nx>day</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>?</span> <span class=o>-</span><span class=mi>6</span> <span class=o>:</span> <span class=mi>1</span><span class=p>);</span> <span class=c1>// adjust when day is sunday
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>setDate</span><span class=p>(</span><span class=nx>diff</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>lastnweekday</span> <span class=o>=</span> <span class=nx>getLastNWeeksDate</span><span class=p>(</span><span class=nx>weekNum</span> <span class=o>-</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>firstday</span> <span class=o>=</span> <span class=nx>getMonday</span><span class=p>(</span><span class=nx>lastnweekday</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cal</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CalHeatmap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//一年
</span></span></span><span class=line><span class=cl><span class=c1>// cal.paint({
</span></span></span><span class=line><span class=cl><span class=c1>//   theme: &#34;dark&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//   domain: { type: &#34;month&#34; },
</span></span></span><span class=line><span class=cl><span class=c1>//   subDomain: { type: &#34;day&#34;, label: &#34;D&#34;, sort: &#34;asc&#34; },
</span></span></span><span class=line><span class=cl><span class=c1>// });
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//一月
</span></span></span><span class=line><span class=cl><span class=c1>// cal.paint({
</span></span></span><span class=line><span class=cl><span class=c1>//   theme: &#34;dark&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//   domain: {
</span></span></span><span class=line><span class=cl><span class=c1>//     type: &#34;month&#34;,
</span></span></span><span class=line><span class=cl><span class=c1>//     label: {
</span></span></span><span class=line><span class=cl><span class=c1>//       text: null, //不显示标签
</span></span></span><span class=line><span class=cl><span class=c1>//     },
</span></span></span><span class=line><span class=cl><span class=c1>//   },
</span></span></span><span class=line><span class=cl><span class=c1>//   range: 1,
</span></span></span><span class=line><span class=cl><span class=c1>//   subDomain: { type: &#34;day&#34;, label: &#34;D&#34;, sort: &#34;asc&#34; },
</span></span></span><span class=line><span class=cl><span class=c1>// });
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/*深色与明亮主题初始值判断*/</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>isDark</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>className</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;dark&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// console.log(&#34;是否深色主题&#34;, isDark);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>hlDate</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toLocaleDateString</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>hlArr</span> <span class=o>=</span> <span class=nx>hlDate</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>dateFormat</span> <span class=o>=</span> <span class=nx>hlArr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>hlArr</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>+</span> <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>hlArr</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>realHLDate</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>dateFormat</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* 参数 */</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>animationDuration</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>theme</span><span class=o>:</span> <span class=nx>isDark</span> <span class=o>?</span> <span class=s2>&#34;dark&#34;</span> <span class=o>:</span> <span class=s2>&#34;light&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>verticalOrientation</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>date</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>start</span><span class=o>:</span> <span class=nx>firstday</span><span class=p>,</span> <span class=c1>//开始时间为上8-2个周的周一
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>highlight</span><span class=o>:</span> <span class=p>[</span><span class=nx>realHLDate</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>locale</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weekStart</span><span class=o>:</span> <span class=mi>1</span> <span class=p>},</span> <span class=c1>//周一为第一天
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>domain</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;week&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>label</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;right&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>text</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span> <span class=c1>//不显示标签
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>range</span><span class=o>:</span> <span class=nx>weekNum</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>subDomain</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>width</span><span class=o>:</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>height</span><span class=o>:</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;day&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// label: &#34;D&#34;, //D是显示日期的日；null是不显示；回调函数是自定义
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>label</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>timestamp</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>sort</span><span class=o>:</span> <span class=s2>&#34;asc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>source</span><span class=o>:</span> <span class=nx>resultList</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span><span class=o>:</span> <span class=s2>&#34;date&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>y</span><span class=o>:</span> <span class=s2>&#34;value&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>scale</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>color</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>range</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;#eea2a4&#34;</span><span class=p>,</span> <span class=s2>&#34;#5c2223&#34;</span><span class=p>],</span> <span class=c1>//[浅色，深色]
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>interpolate</span><span class=o>:</span> <span class=s2>&#34;hsl&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;linear&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>domain</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=c1>//文章数阈值：[min,max]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*深色与明亮主题切换监听*/</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;theme-toggle&#34;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>location</span><span class=p>.</span><span class=nx>reload</span><span class=p>();</span><span class=c1>// 由于没有重新渲染的函数，只能刷新界面
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*渲染*/</span>
</span></span><span class=line><span class=cl><span class=nx>cal</span><span class=p>.</span><span class=nx>paint</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*初始点击的数据*/</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>listObj</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>initClickUrls</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;/index.xml&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>str</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=nb>window</span><span class=p>.</span><span class=nx>DOMParser</span><span class=p>().</span><span class=nx>parseFromString</span><span class=p>(</span><span class=nx>str</span><span class=p>,</span> <span class=s2>&#34;text/xml&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>ls</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>querySelectorAll</span><span class=p>(</span><span class=s2>&#34;channel item&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>listObj</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=nx>ls</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>element</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>eleCollect</span> <span class=o>=</span> <span class=nx>element</span><span class=p>.</span><span class=nx>children</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>dateStr</span> <span class=o>=</span> <span class=nx>eleCollect</span><span class=p>.</span><span class=nx>item</span><span class=p>(</span><span class=mi>2</span><span class=p>).</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>url</span> <span class=o>=</span> <span class=nx>eleCollect</span><span class=p>.</span><span class=nx>item</span><span class=p>(</span><span class=mi>3</span><span class=p>).</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>dateTs</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>dateStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>dateTs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>ymd</span> <span class=o>=</span> <span class=nx>date</span><span class=p>.</span><span class=nx>getFullYear</span><span class=p>()</span> <span class=o>+</span> <span class=s1>&#39;-&#39;</span> <span class=o>+</span> <span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;-&#39;</span> <span class=o>+</span> <span class=nx>date</span><span class=p>.</span><span class=nx>getDate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>listObj</span><span class=p>.</span><span class=nx>hasOwnProperty</span><span class=p>(</span><span class=nx>ymd</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>listObj</span><span class=p>[</span><span class=nx>ymd</span><span class=p>][</span><span class=s1>&#39;url&#39;</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>listObj</span><span class=p>[</span><span class=nx>ymd</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;date&#39;</span><span class=o>:</span> <span class=nx>ymd</span><span class=p>,</span> <span class=s1>&#39;url&#39;</span><span class=o>:</span> <span class=p>[</span><span class=nx>url</span><span class=p>]</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>listObj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>initClickUrls</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//事件处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cal</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s2>&#34;mouseover&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>timestamp</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>dateFormat</span> <span class=o>=</span> <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=nx>Appendzero</span><span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getDate</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>str</span> <span class=o>=</span> <span class=s1>&#39;周&#39;</span> <span class=o>+</span> <span class=s1>&#39;日一二三四五六&#39;</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>).</span><span class=nx>getDay</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>tips</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>value</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tips</span> <span class=o>=</span> <span class=nx>str</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=nx>dateFormat</span> <span class=o>+</span> <span class=s2>&#34; , 懒虫!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tips</span> <span class=o>=</span> <span class=nx>str</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=nx>dateFormat</span> <span class=o>+</span> <span class=s2>&#34; , &#34;</span> <span class=o>+</span> <span class=nx>value</span> <span class=o>+</span> <span class=s2>&#34; 篇&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>tippy</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>placement</span><span class=o>:</span> <span class=s2>&#34;top&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span><span class=o>:</span> <span class=nx>tips</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>cal</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>timestamp</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>ymd</span> <span class=o>=</span> <span class=nx>date</span><span class=p>.</span><span class=nx>getFullYear</span><span class=p>()</span> <span class=o>+</span> <span class=s1>&#39;-&#39;</span> <span class=o>+</span> <span class=p>(</span><span class=nx>date</span><span class=p>.</span><span class=nx>getMonth</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;-&#39;</span> <span class=o>+</span> <span class=nx>date</span><span class=p>.</span><span class=nx>getDate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>dateObj</span> <span class=o>=</span> <span class=nx>listObj</span><span class=p>[</span><span class=nx>ymd</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>dateObj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>urlList</span> <span class=o>=</span> <span class=nx>dateObj</span><span class=p>.</span><span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>urlList</span> <span class=o>&amp;&amp;</span> <span class=nx>urlList</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=nx>locationHref</span> <span class=o>=</span> <span class=nx>urlList</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=nx>urlList</span><span class=p>.</span><span class=nx>length</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>      <span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>locationHref</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div></div>多种样式，如显示1年，1个月，2个月等自行修改代码，因为我的主题适合规规矩矩的，所以使用8周为时间单位。</p><p>(可忽略) 在static/css 新增主逻辑文件footer-home.css，更新看本人的github项目</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>first-entry</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>position</span><span class=p>:</span> <span class=kc>relative</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>row</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>justify-content</span><span class=p>:</span> <span class=kc>space-between</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>align-items</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>min-height</span><span class=p>:</span> <span class=mi>320</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>cal-heatmap-container</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>row</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>justify-content</span><span class=p>:</span> <span class=kc>flex-end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>align-items</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=n>max-content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=引入主文件>引入主文件<a hidden class=anchor aria-hidden=true href=#引入主文件>#</a></h3><p>在themes/xxx/layouts/partials/extend_footer.html 尾部插入代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{- if .IsHome }}
</span></span><span class=line><span class=cl>{{- /* cal-heatmap */ -}}
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/javascript&#34;</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;js/cal-heatmap.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;css/footer-home.css&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{- end }}
</span></span></code></pre></div><p>大功告成~ 如有疑问可留言！</p><h3 id=后续问题>后续问题<a hidden class=anchor aria-hidden=true href=#后续问题>#</a></h3><ul><li><input checked disabled type=checkbox> dark/light主题切换问题</li><li><input checked disabled type=checkbox> tooltip显示</li><li><input checked disabled type=checkbox> 点击日期进入相关post页面</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.xlap.top/tags/heatmap/>heatmap</a></li><li><a href=https://blog.xlap.top/tags/hugo/>hugo</a></li><li><a href=https://blog.xlap.top/tags/%E7%83%AD%E5%8A%9B%E5%9B%BE/>热力图</a></li></ul><nav class=paginav><a class=prev href=https://blog.xlap.top/post/tech/hugoconfig/><span class=title>« 上一页</span><br><span>Hugo个人博客站点常用配置</span></a>
<a class=next href=https://blog.xlap.top/post/tech/opensourceproject/><span class=title>下一页 »</span><br><span>好玩有用的开源项目</span></a></nav></footer><div class=pagination__title><span class=pagination__title-h>欢迎留言</span><hr></div><div id=tcomment></div><script>twikoo.init({envId:"https://db.twk.xlap.top",el:"#tcomment"})</script></article></main><footer class=footer><p class=logos><a style=border-bottom:unset href=https://www.foreverblog.cn/go.html target=_blank><img src=https://img.foreverblog.cn/wormhole_3_tp.gif height=28 title=穿梭虫洞-随机访问十年之约友链博客></a></p><span>&copy; 2025 <a href=https://blog.xlap.top/>Cheman</a></span>
<span>·&nbsp;Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;·&nbsp;Theme
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>&nbsp;·
<a href=/sitemap.xml rel=noopener target=_blank>Sitemap</a>&nbsp;·&nbsp;
<script id=LA-DATA-WIDGET crossorigin=anonymous src="https://v6-widget.51.la/v6/JvUDwnR8WxIRefWQ/quote.js?theme=#9B9C9D,#9B9C9D,#9B9C9D,#9B9C9D,#9B9C9D,#9B9C9D,12&f=12&display=0,0,0,0,0,0,0,1"></script></span><p id=hitokoto><span id=hitokoto_text>...</span></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/javascript color=238,162,164 src=https://cdn.jsdelivr.net/npm/canvas-nest.js/dist/canvas-nest.js></script>
<script>fetch("https://v1.hitokoto.cn").then(e=>e.json()).then(e=>{var t=`${e.hitokoto} —— ${e.from_who||""}《${e.from}》`;const n=document.querySelector("#hitokoto_text");n.innerText=t}).catch(console.error)</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>